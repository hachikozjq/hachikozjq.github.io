{"title":"local介绍","uid":"e64ccaddd5bd6fb47aae132e76880912","slug":"JAVA/local介绍","date":"2022-03-03T10:37:06.000Z","updated":"2022-03-05T07:14:53.638Z","comments":true,"path":"api/articles/JAVA/local介绍.json","keywords":"Java","cover":"https://gitee.com/hachikozjq/images/raw/master/blog/202202211612556.jpeg","content":"<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><hr>\n<h3 id=\"用到的开源框架：\"><a href=\"#用到的开源框架：\" class=\"headerlink\" title=\"用到的开源框架：\"></a>用到的开源框架：</h3><p>微服务：SpringBoot 2.3.2.RELEASE+SpringCloudAlibaba 2.2.6.RELEASE+Dubbo 2.7.8+Nacos 2.0.3<br>限流哨兵：Sentinel 1.8.3<br>分布式调度任务：xxl-job 2.3.0<br>分布式任务：seata 1.4.2</p>\n<h3 id=\"Nocos：\"><a href=\"#Nocos：\" class=\"headerlink\" title=\"Nocos：\"></a><a href=\"http://172.16.227.44:8848/nacos/\">Nocos：</a></h3><p>u：nacos，p：nacos</p>\n<h4 id=\"配置中心：\"><a href=\"#配置中心：\" class=\"headerlink\" title=\"配置中心：\"></a>配置中心：</h4><ul>\n<li><p>NameSpace，命名空间<br>public，微服务的配置<br>seata，存放seata的规则<br>sentinel，存放限流的规则</p>\n</li>\n<li><p>我们只关心public命名空间</p>\n<ul>\n<li><p>global-web.yml，global-center.yml，global-gateway.yml三者可以不用关心，是作为全局的配置，具体可以点详情进去，每项配置有说明<br>e.g.</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># sentinel</span>\n<span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># 取消Sentinel控制台懒加载</span>\n      <span class=\"token key atrule\">eager</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token comment\"># 限流规则持久化保存到nacos数据库中，可以实现服务重启后不丢失规则</span>\n      <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\n       <span class=\"token comment\"># 流控规则</span>\n        <span class=\"token key atrule\">flow</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 注册地址</span>\n            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.config.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n            <span class=\"token comment\"># 配置组，默认sentinel的组</span>\n            <span class=\"token key atrule\">group-id</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP\n            <span class=\"token comment\"># 限流类型：流控</span>\n            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> flow\n            <span class=\"token comment\"># 配置的dataId</span>\n            <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>flow<span class=\"token punctuation\">-</span>rules\n            <span class=\"token comment\"># 配置的格式，json</span>\n            <span class=\"token key atrule\">data-type</span><span class=\"token punctuation\">:</span> json\n            <span class=\"token comment\"># 配置中心的命名空间，默认sentinel</span>\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> sentinel\n        <span class=\"token comment\"># 熔断规则</span>\n        <span class=\"token key atrule\">degrade</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.config.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n            <span class=\"token key atrule\">group-id</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP\n            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> degrade\n            <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>degrade<span class=\"token punctuation\">-</span>rules\n            <span class=\"token key atrule\">data-type</span><span class=\"token punctuation\">:</span> json\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> sentinel\n        <span class=\"token comment\"># 系统规则</span>\n        <span class=\"token key atrule\">system</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.config.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n            <span class=\"token key atrule\">group-id</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP\n            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> system\n            <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>rules\n            <span class=\"token key atrule\">data-type</span><span class=\"token punctuation\">:</span> json\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> sentinel\n        <span class=\"token comment\"># 授权规则</span>\n        <span class=\"token key atrule\">authority</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.config.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n            <span class=\"token key atrule\">group-id</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP\n            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> authority\n            <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>authority<span class=\"token punctuation\">-</span>rules\n            <span class=\"token key atrule\">data-type</span><span class=\"token punctuation\">:</span> json\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> sentinel\n        <span class=\"token comment\"># 热点规则</span>\n        <span class=\"token key atrule\">param-flow</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.config.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n            <span class=\"token key atrule\">group-id</span><span class=\"token punctuation\">:</span> SENTINEL_GROUP\n            <span class=\"token key atrule\">rule-type</span><span class=\"token punctuation\">:</span> param<span class=\"token punctuation\">-</span>flow\n            <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>param<span class=\"token punctuation\">-</span>rules\n            <span class=\"token key atrule\">data-type</span><span class=\"token punctuation\">:</span> json\n            <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> sentinel\n<span class=\"token comment\"># dubbo</span>\n<span class=\"token key atrule\">dubbo</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">consumer</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 启动不检测dubbo的健康，防止center没启，导致web也启不起来</span>\n    <span class=\"token key atrule\">check</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># 消费者订阅的提供者appName，在具体web项目里的application.yml里配置，这里不动</span>\n    <span class=\"token key atrule\">subscribed-services</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>provider.application.name<span class=\"token punctuation\">&#125;</span>\n  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># dubbo注册地址</span>\n    <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>cloud<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.discovery.ip<span class=\"token punctuation\">&#125;</span>\n  <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dubbo\n    <span class=\"token comment\"># 上公司环境后改为-1</span>\n    <span class=\"token comment\"># dubbo随机端口</span>\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">-1</span>\n<span class=\"token comment\"># endpoints</span>\n<span class=\"token key atrule\">management</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">endpoints</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">exposure</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 这个不多说，提供了endpoints的接口</span>\n        <span class=\"token key atrule\">include</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> hessian2Redis\n          <span class=\"token punctuation\">-</span> health\n          <span class=\"token punctuation\">-</span> info\n<span class=\"token comment\"># seata</span>\n<span class=\"token key atrule\">seata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># 开启分布式事务</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token comment\"># 服务名</span>\n  <span class=\"token key atrule\">application-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.application.name<span class=\"token punctuation\">&#125;</span>\n  <span class=\"token comment\"># 分布式事务组</span>\n  <span class=\"token key atrule\">tx-service-group</span><span class=\"token punctuation\">:</span> project_local\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">vgroup-mapping</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">project_local</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token comment\"># 集成nacos的配置中心</span>\n  <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos\n    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># 配置命名空间</span>\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> seata\n      <span class=\"token comment\"># 注册中心地址</span>\n      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.discovery.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n      <span class=\"token comment\"># 配置中心组，默认SEATA组</span>\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP\n      <span class=\"token comment\"># 配置的dataId</span>\n      <span class=\"token key atrule\">data-id</span><span class=\"token punctuation\">:</span> seataServer.properties\n  <span class=\"token comment\"># 将seata注册到nacos</span>\n  <span class=\"token key atrule\">registry</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> nacos\n    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> SEATA_GROUP\n      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span>spring.cloud.nacos.discovery.server<span class=\"token punctuation\">-</span>addr<span class=\"token punctuation\">&#125;</span>\n      <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span> seata<span class=\"token punctuation\">-</span>server\n      <span class=\"token key atrule\">cluster</span><span class=\"token punctuation\">:</span> default\n      <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> seata<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>goods-center.yml，user-center.yml，goods-web.yml具体微服务的配置文件，主要存放一些各自服务的配置，如数据源等。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"sentinel限流：\"><a href=\"#sentinel限流：\" class=\"headerlink\" title=\"sentinel限流：\"></a><a href=\"http://172.16.227.44:8080/\">sentinel限流：</a></h3><p>u：sentinel，p：sentinel</p>\n<ul>\n<li>第一种可以在簇点链路中，直接找到对应的请求，加上各种类型的限流</li>\n</ul>\n<p><img src=\"https://gitee.com/hachikozjq/images/raw/master/blog/202203042047785.png\" alt=\"202203031838120\"></p>\n<ul>\n<li>第二种可以在左侧列表中，直接加对应的流控规则，具体的选项看看官网吧，资源名一般我们都用url地址</li>\n</ul>\n<p><img src=\"https://gitee.com/hachikozjq/images/raw/master/blog/202203042047945.png\" alt=\"202203031838519\"></p>\n<ul>\n<li>第三种查看实时监控，如上配置了1秒qps的限流，下图中可以反映出每秒通过的数量就是1</li>\n</ul>\n<p><img src=\"https://gitee.com/hachikozjq/images/raw/master/blog/202203042047584.png\" alt=\"202203031838927\"></p>\n<h3 id=\"xxl-job：\"><a href=\"#xxl-job：\" class=\"headerlink\" title=\"xxl-job：\"></a><a href=\"http://172.16.227.44:8081/xxl-job-admin\">xxl-job：</a></h3><p>u：admin，p：123456</p>\n<p>看官方文档，很详细了，可以直接登录</p>\n<h3 id=\"seata：\"><a href=\"#seata：\" class=\"headerlink\" title=\"seata：\"></a>seata：</h3><p>待</p>\n<h3 id=\"相关db初始化文件：\"><a href=\"#相关db初始化文件：\" class=\"headerlink\" title=\"相关db初始化文件：\"></a>相关db初始化文件：</h3><p><a href=\"https://github.com/hachikozjq/local-db-init/tree/main/db\">go</a></p>\n","feature":true,"text":"介绍 用到的开源框架：微服务：SpringBoot 2.3.2.RELEASE+SpringCloudAlibaba 2.2.6.RELEASE+Dubbo 2.7.8+Nacos 2.0.3限流哨兵：Sentinel 1.8.3分布式调度任务：xxl-job 2.3.0分布式任...","link":"","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"JAVA","slug":"JAVA","count":1,"path":"api/categories/JAVA.json"}],"tags":[{"name":"JAVA","slug":"JAVA","count":1,"path":"api/tags/JAVA.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">介绍</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%A8%E5%88%B0%E7%9A%84%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6%EF%BC%9A\"><span class=\"toc-text\">用到的开源框架：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Nocos%EF%BC%9A\"><span class=\"toc-text\">Nocos：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%9A\"><span class=\"toc-text\">配置中心：</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#sentinel%E9%99%90%E6%B5%81%EF%BC%9A\"><span class=\"toc-text\">sentinel限流：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#xxl-job%EF%BC%9A\"><span class=\"toc-text\">xxl-job：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#seata%EF%BC%9A\"><span class=\"toc-text\">seata：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9B%B8%E5%85%B3db%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%87%E4%BB%B6%EF%BC%9A\"><span class=\"toc-text\">相关db初始化文件：</span></a></li></ol></li></ol></li></ol>","author":{"name":"Hachiko_JQ","slug":"blog-author","avatar":"https://gitee.com/hachikozjq/images/raw/master/blog/202202182057148.jpeg","link":"/","description":"✌️给生活比个耶✌️","socials":{"github":"https://github.com/hachikozjq","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/1736409885","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Mac必装软件","uid":"855d228ba0384bba0ec97c43bd96d618","slug":"运维/Mac必装软件","date":"2022-03-05T10:35:54.000Z","updated":"2022-03-05T12:45:49.089Z","comments":true,"path":"api/articles/运维/Mac必装软件.json","keywords":"Java","cover":"https://gitee.com/hachikozjq/images/raw/master/blog/202202211612556.jpeg","text":"Mac必装软件准备工作：如果出现连接443的情况下，可以上https://ipaddress.com查询ip，然后修改hosts文件ip domain的格式 brew镜像安装脚本：/usr/bin/ruby -e &quot;$(curl -fsSL https://cdn.js...","link":"","photos":[],"count_time":{"symbolsCount":976,"symbolsTime":"1 mins."},"categories":[{"name":"运维","slug":"运维","count":5,"path":"api/categories/运维.json"}],"tags":[{"name":"软件","slug":"软件","count":3,"path":"api/tags/软件.json"},{"name":"Mac","slug":"Mac","count":1,"path":"api/tags/Mac.json"}],"author":{"name":"Hachiko_JQ","slug":"blog-author","avatar":"https://gitee.com/hachikozjq/images/raw/master/blog/202202182057148.jpeg","link":"/","description":"✌️给生活比个耶✌️","socials":{"github":"https://github.com/hachikozjq","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/1736409885","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Jetbrains系列产品重置试用方法","uid":"fd270390fcc2a51eddfa94a5e97c1100","slug":"运维/Jetbrains系列产品重置试用方法","date":"2022-02-22T14:04:09.000Z","updated":"2022-03-05T07:14:53.638Z","comments":true,"path":"api/articles/运维/Jetbrains系列产品重置试用方法.json","keywords":"Java","cover":"https://gitee.com/hachikozjq/images/raw/master/blog/202202211612556.jpeg","text":"注：本文转载于zhi神zhile 没错，jetbrains-agent这个项目停止了。市面上漫天飞的各种最新都是其他大神的魔改版本。[&#x2F;斜眼]我不是要专门写个博文来说明jetbrains-agent项目已经停止，然后缅怀感叹一番。这篇文章是想和大家聊聊另一种思路。 本项...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"运维","slug":"运维","count":5,"path":"api/categories/运维.json"}],"tags":[{"name":"Idea","slug":"Idea","count":1,"path":"api/tags/Idea.json"}],"author":{"name":"Hachiko_JQ","slug":"blog-author","avatar":"https://gitee.com/hachikozjq/images/raw/master/blog/202202182057148.jpeg","link":"/","description":"✌️给生活比个耶✌️","socials":{"github":"https://github.com/hachikozjq","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/1736409885","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}